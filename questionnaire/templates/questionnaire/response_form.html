{% load static %}

<!DOCTYPE html>
<html>
    <head>
        <title>Responce</title>
        <style>
            #canvas {
                margin-left: 10px;
                margin-top: 10px;
                border: thin solid #000000;
            }
        </style>
    </head>
    <body id="body">
        <h2>Question1 Title</h2>
        <form method="POST">{% csrf_token %}
            {{ form.as_p }}
            <div id="canvas-holder">
                <canvas id="canvas"></canvas>
            </div>
            
            <button type="submit">Submit</button>
        </form>

    <script>
        var drawing_field = document.getElementById("id_drawing");
        // get canvas
        var canvas = document.getElementById("canvas")

        var background = new Image();
        background.src = '{% static "questionnaire/canvas_background.jpg" %}';

        background.onload = function(){
            ctx.drawImage(background,0,0);   
        };

        canvas.width = background.width;
        canvas.height = background.height;

        // get canvas 2D context and set him correct size
        var ctx = canvas.getContext('2d');
        ctx.canvas.width = canvas.width;
        ctx.canvas.height = canvas.height;

        // last known position
        var pos = { x: 0, y: 0 };

        document.addEventListener('mousemove', draw);
        document.addEventListener('mousedown', setPosition);
        document.addEventListener('mouseup', save)
        document.addEventListener('mouseenter', setPosition);

        // new position from mouse event
        function setPosition(e) {
            var rect = canvas.getBoundingClientRect();
            pos.x = e.clientX - rect.left;
            pos.y = e.clientY - rect.top;
        }

        function draw(e) {
            // mouse left button must be pressed
            if (e.buttons !== 1) return;

            ctx.beginPath(); // begin

            ctx.lineWidth = 5;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#000000';

            ctx.moveTo(pos.x, pos.y); // from
            setPosition(e);
            ctx.lineTo(pos.x, pos.y); // to

            ctx.stroke(); // draw it!
        }
    
        function save(e) {
            var img_data = ctx.getImageData(0, 0, canvas.width, canvas.height);
            console.log(img_data.data);

            drawing_field.value = img_data;
        }
    </script>
    </body>
    
</html>
